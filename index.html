<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>アズレン設定判別ツール</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; background:#f7f7f7; margin:0; padding:16px; }
    h1 { font-size:1.4rem; }
    h2 { margin-top:24px; font-size:1.1rem; }
    .card { background:#fff; border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
    .row { display:flex; align-items:center; gap:8px; margin-bottom:8px; flex-wrap:wrap; }
    label { min-width:140px; }
    input[type=number] { width:90px; padding:4px; }
    input[type=checkbox] { transform:scale(1.2); }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { padding:6px; text-align:center; border-bottom:1px solid #ddd; }
    th { background:#fafafa; }
    .note { font-size:0.85rem; color:#555; }
    .result-high { font-weight:bold; color:#d22; }
  </style>
</head>
<body>

<h1>スロット設定判別ツール</h1>

<div class="card">
  <h2>① 小役確率</h2>
  <div class="row">
    <label>総ゲーム数（共通）</label>
    <input type="number" id="games" min="0" /> G
  </div>
  <div class="row"><label>共通ベル 回数</label><input type="number" id="bell" min="0" /></div>
  <div class="row"><label>弱チェ 回数</label><input type="number" id="weak" min="0" /></div>
  <div class="row"><label>スイカ 回数</label><input type="number" id="suika" min="0" /></div>
</div>

<div class="card">
  <h2>② 終了画面（回数入力）</h2>
  <div id="endScreens"></div>
</div>

<div class="card">
  <h2>③ 明石チャレンジ告知（回数入力）</h2>
  <div id="akashi"></div>
</div>

<div class="card">
  <h2>④ 確定系（1回でも出たらチェック）</h2>
  <div id="confirm"></div>
  <p class="note">※ トロフィーはボーナス／AT終了時に出現する可能性あり<br>※ 獲得枚数表示は複数回出る可能性あり</p>
</div>

<div class="card">
  <h2>推測結果</h2>
  <table id="result"></table>
</div>

<script>
const settings = [1,2,3,4,5,6];

// ---- 確率データ ----
const small = {
  bell:[1/22.1,1/21.7,1/21.0,1/20.4,1/19.8,1/18.9],
  weak:[1/79.0,1/78.0,1/77.1,1/75.3,1/74.5,1/72.0],
  suika:[1/104.0,1/102.4,1/100.8,1/99.3,1/97.8,1/96.4]
};

const endScreens = {
  'エンタープライズ':[0.433,0.334,0.501,0.294,0.436,0.287],
  'ベルファスト':[0.433,0.501,0.334,0.441,0.291,0.430],
  'エンプラ&ベル':[0.125,0.125,0.125,0.20,0.206,0.213],
  '赤城':[0.01,0.01,0.01,0.032,0.035,0.036],
  '全員集合':[0,0.03,0.03,0.03,0.03,0.03],
  '加賀&赤城':[0,0,0,0.002,0.002,0.003],
  'パーティ':[0,0,0,0,0,0.001]
};

const akashiData = {
  '奇数G告知':[0.72,0.18,0.72,0.18,0.72,0.18],
  '偶数G告知':[0.18,0.72,0.18,0.72,0.18,0.72],
  '最終G告知':[0.10,0.10,0.10,0.10,0.10,0.10]
};

const confirmData = {
  '銅トロフィー':[false,true,true,true,true,true],
  '銀トロフィー':[false,false,false,true,true,true],
  '金トロフィー':[false,false,false,true,true,true],
  'ゼブラ柄トロフィー':[false,false,false,false,true,true],
  '虹トロフィー':[false,false,false,false,false,true],
  '456枚over':[false,false,false,true,true,true],
  '666枚over':[false,false,false,false,false,true]
};

// ---- UI生成 ----
function buildInputs(target, data){
  for(const k in data){
    target.innerHTML += `<div class=\"row\"><label>${k}</label><input type=\"number\" id=\"${k}\" min=\"0\" value=\"0\"></div>`;
  }
}

function buildChecks(target, data){
  for(const k in data){
    target.innerHTML += `<div class=\"row\"><label>${k}</label><input type=\"checkbox\" id=\"${k}\"></div>`;
  }
}

buildInputs(document.getElementById('endScreens'), endScreens);
buildInputs(document.getElementById('akashi'), akashiData);
buildChecks(document.getElementById('confirm'), confirmData);

// ---- 計算（対数尤度） ----
function calc(){
  let logL = Array(6).fill(0);

  const n = Number(games.value)||0;
  if(n>0){
    for(const key in small){
      const k = Number(document.getElementById(key).value)||0;
      small[key].forEach((p,i)=>{
        if(p>0 && p<1 && k<=n){
          logL[i] += k*Math.log(p) + (n-k)*Math.log(1-p);
        }
      });
    }
  }

  for(const key in endScreens){
    const c = Number(document.getElementById(key).value)||0;
    endScreens[key].forEach((p,i)=>{
      if(p>0 && c>0) logL[i] += c*Math.log(p);
    });
  }

  for(const key in akashiData){
    const c = Number(document.getElementById(key).value)||0;
    akashiData[key].forEach((p,i)=>{
      if(p>0 && c>0) logL[i] += c*Math.log(p);
    });
  }

  for(const key in confirmData){
    if(document.getElementById(key).checked){
      confirmData[key].forEach((ok,i)=>{
        if(!ok) logL[i] = -Infinity;
      });
    }
  }

  const maxLog = Math.max(...logL);
  let L = logL.map(v => v===-Infinity ? 0 : Math.exp(v-maxLog));
  const sum = L.reduce((a,b)=>a+b,0);
  const result = L.map(v=>sum? v/sum:0);

  let html = '<tr><th>設定</th>' + settings.map(s=>`<th>${s}</th>`).join('') + '</tr>';
  const maxV = Math.max(...result);
  html += '<tr><th>確率</th>' + result.map(v=>`<td class=\"${v===maxV?'result-high':''}\">${(v*100).toFixed(1)}%</td>`).join('') + '</tr>';
  document.getElementById('result').innerHTML = html;
}

document.body.addEventListener('input', calc);
document.body.addEventListener('change', calc);
calc();
</script>

</body>
</html>
